<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAT GAMES | Street Racing Edition</title>
    <style>
        body { 
            margin: 0; background: #0a0a0a; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            height: 100vh; font-family: 'Courier New', monospace; color: white; 
            overflow: hidden; touch-action: manipulation;
        }
        .game-wrapper { position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.9); }
        canvas { border: 4px solid #222; background: #333; display: block; image-rendering: pixelated; }
        
        .ui { position: absolute; top: 20px; width: 100%; text-align: center; pointer-events: none; text-shadow: 2px 2px #000; z-index: 10; }
        .brand { position: absolute; top: 15px; right: 20px; text-align: right; z-index: 10;}
        .brand .title { font-size: 16px; font-weight: bold; color: #3498db; font-style: italic; }
        .brand .author { font-size: 11px; opacity: 0.9; color: #ecf0f1; }

        .controls { display: flex; justify-content: space-between; width: 400px; margin-top: 20px; gap: 20px; }
        .btn-group { display: flex; gap: 10px; }
        .btn { 
            width: 70px; height: 70px; background: #222; border: 3px solid #555; 
            color: white; display: flex; align-items: center; justify-content: center; 
            font-size: 28px; cursor: pointer; user-select: none; border-radius: 8px;
            box-shadow: 0 4px #111;
        }
        .btn:active { background: #3498db; transform: translateY(4px); box-shadow: 0 0 #111; }
        
        #msg { 
            background: rgba(0,0,0,0.9); padding: 15px 25px; border-radius: 4px; 
            margin-top: 10px; cursor: pointer; pointer-events: auto; border: 2px solid #3498db;
            font-weight: bold; letter-spacing: 1px;
        }
    </style>
</head>
<body>

    <div class="game-wrapper">
        <div class="ui">
            <h2 id="score">SKOR: 0</h2>
            <div id="msg" onclick="startGame()">YARIŞA BAŞLA</div>
        </div>
        <div class="brand">
            <div class="title">MAT STREET RACING</div>
            <div class="author">gokhantaylan</div>
        </div>
        <canvas id="gameCanvas" width="400" height="500"></canvas>
    </div>

    <div class="controls">
        <div class="btn-group">
            <div class="btn" id="btnLeft">◀</div>
            <div class="btn" id="btnRight">▶</div>
        </div>
        <div class="btn" id="btnPause">P</div>
    </div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreElement = document.getElementById("score");
    const msgElement = document.getElementById("msg");

    let gameRunning = false, paused = false, score = 0, speed = 8, frame = 0;
    const ROAD_WIDTH = 280, LANES = 3, LANE_W = ROAD_WIDTH / LANES;

    // Araba Modelleri
    const MODELS = { SKYLINE: 'skyline', CHARGER: 'charger', SUPRA: 'supra', S2000: 's2000' };

    // Oyuncu: Nissan Skyline GT-R R34 (Gümüş/Mavi)
    const player = { lane: 1, targetX: 0, currentX: 0, y: 380, w: 42, h: 76, model: MODELS.SKYLINE, color: "#bdc3c7" };
    let enemies = [];

    // Rakipler: F&F İkonları
    const enemyTypes = [
        { model: MODELS.CHARGER, color: "#111" }, // Dom
        { model: MODELS.SUPRA, color: "#e67e22" }, // Brian Orange
        { model: MODELS.S2000, color: "#fd79a8" } // Suki Pink
    ];

    // --- SES MOTORU ---
    let audioCtx, oscillator, gainNode;
    function initEngineSound() {
        try {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            oscillator = audioCtx.createOscillator();
            gainNode = audioCtx.createGain();
            oscillator.type = 'sawtooth';
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            gainNode.gain.value = 0.03; 
            oscillator.start();
        } catch(e) {}
    }
    function updateEnginePitch() {
        if (oscillator && !paused && gameRunning) {
            oscillator.frequency.setTargetAtTime(50 + (speed * 5), audioCtx.currentTime, 0.1);
            gainNode.gain.setTargetAtTime(0.03, audioCtx.currentTime, 0.1);
        } else if (gainNode) gainNode.gain.setTargetAtTime(0, audioCtx.currentTime, 0.1);
    }

    // --- KONTROLLER ---
    window.addEventListener("keydown", e => {
        if (!gameRunning) return;
        if (e.code === "KeyP") togglePause();
        if (!paused) {
            if (e.code === "ArrowLeft" && player.lane > 0) player.lane--;
            if (e.code === "ArrowRight" && player.lane < LANES - 1) player.lane++;
        }
    });
    function setupBtn(id, action) {
        const btn = document.getElementById(id);
        const handle = (e) => { e.preventDefault(); action(); };
        btn.addEventListener("mousedown", handle); btn.addEventListener("touchstart", handle);
    }
    setupBtn("btnLeft", () => { if(gameRunning && !paused && player.lane > 0) player.lane--; });
    setupBtn("btnRight", () => { if(gameRunning && !paused && player.lane < LANES - 1) player.lane++; });
    setupBtn("btnPause", () => { if(gameRunning) togglePause(); });

    function togglePause() { paused = !paused; msgElement.style.display = paused ? "block" : "none"; msgElement.innerText = "PAUSED"; }
    function startGame() { if (!gameRunning) { if(!audioCtx) initEngineSound(); resetGame(); gameRunning = true; update(); } else if (paused) { paused = false; msgElement.style.display = "none"; }}
    function resetGame() { score = 0; speed = 8; frame = 0; enemies = []; player.lane = 1; player.currentX = getLaneX(1); player.targetX = player.currentX; paused = false; msgElement.style.display = "none"; scoreElement.innerText = "SKOR: 0"; }
    function getLaneX(lane) { return (canvas.width / 2 - ROAD_WIDTH / 2) + (lane * LANE_W) + (LANE_W / 2 - player.w / 2); }

    // --- GELİŞMİŞ ARABA ÇİZİMİ (PIXEL ART) ---
    function drawCar(car) {
        const { x, y, w, h, model, color } = car;
        ctx.fillStyle = color;

        // Temel Gövde (Tüm araçlar için)
        ctx.fillRect(x+2, y, w-4, h-2); // Ana gövde
        ctx.fillStyle = "rgba(0,0,0,0.3)"; // Yan gölgeler
        ctx.fillRect(x, y+5, 2, h-10); ctx.fillRect(x+w-2, y+5, 2, h-10);

        // Tekerlekler
        ctx.fillStyle = "#111";
        [10, h-18].forEach(wy => { ctx.fillRect(x, y+wy, 3, 12); ctx.fillRect(x+w-3, y+wy, 3, 12); });

        // Modele Özel Detaylar
        switch(model) {
            case MODELS.SKYLINE: // R34
                // Mavi Şeritler
                ctx.fillStyle = "#3498db";
                ctx.fillRect(x+10, y, 4, h-5); ctx.fillRect(x+w-14, y, 4, h-5);
                // Cam
                ctx.fillStyle = "#8e44ad"; ctx.fillRect(x+4, y+18, w-8, 16);
                // Rüzgarlık (Kutulu)
                ctx.fillStyle = "#111"; ctx.fillRect(x+2, y+h-8, w-4, 6);
                // Stoplar (4 yuvarlak kırmızı)
                ctx.fillStyle = "#e74c3c";
                ctx.fillRect(x+6, y+h-4, 4, 3); ctx.fillRect(x+12, y+h-4, 4, 3);
                ctx.fillRect(x+w-16, y+h-4, 4, 3); ctx.fillRect(x+w-10, y+h-4, 4, 3);
                break;

            case MODELS.CHARGER: // Dom's Muscle Car
                // Cam (Daha dar)
                ctx.fillStyle = "#333"; ctx.fillRect(x+5, y+22, w-10, 12);
                // Motor Blower (Kaput üstü çıkıntı)
                ctx.fillStyle = "#7f8c8d"; ctx.fillRect(x+w/2-6, y+8, 12, 14);
                ctx.fillStyle = "#95a5a6"; ctx.fillRect(x+w/2-4, y+6, 8, 4); // Hava girişi
                // Arka Stop (Tek parça kırmızı)
                ctx.fillStyle = "#c0392b"; ctx.fillRect(x+4, y+h-5, w-8, 4);
                break;

            case MODELS.SUPRA: // Brian's Orange
                // Cam (Kavisli hissi)
                ctx.fillStyle = "#d35400"; ctx.fillRect(x+5, y+20, w-10, 15);
                // Yan Grafikler (Siyah detay)
                ctx.fillStyle = "#111"; ctx.fillRect(x+2, y+35, 3, 20); ctx.fillRect(x+w-5, y+35, 3, 20);
                // Dev Rüzgarlık (Kavisli)
                ctx.fillStyle = color; ctx.fillRect(x, y+h-10, w, 8);
                ctx.fillStyle = "#111"; ctx.fillRect(x+4, y+h-8, w-8, 4); // Kanat altı
                break;
                
            case MODELS.S2000: // Suki Pink Convertible
                // Üstü Açık (Koyu iç mekan)
                ctx.fillStyle = "#2c3e50"; ctx.fillRect(x+5, y+25, w-10, 18);
                // Ön Cam Çerçevesi
                ctx.fillStyle = "#fd79a8"; ctx.fillRect(x+5, y+22, w-10, 3);
                // Küçük Rüzgarlık
                ctx.fillStyle = "#e84393"; ctx.fillRect(x+4, y+h-6, w-8, 4);
                break;
        }
    }

    function drawRoad() {
        ctx.fillStyle = "#2c3e50"; ctx.fillRect(0, 0, canvas.width, canvas.height); // Asfalt
        const roadX = canvas.width / 2 - ROAD_WIDTH / 2;
        // Yol Kenarları (Kırmızı-Beyaz Bordür)
        const kerbSize = 15;
        for(let i=-frame%kerbSize; i<canvas.height; i+=kerbSize){
            ctx.fillStyle = (Math.floor((i+frame)/kerbSize)%2===0) ? "#e74c3c" : "#ecf0f1";
            ctx.fillRect(roadX-kerbSize, i, kerbSize, kerbSize);
            ctx.fillRect(roadX+ROAD_WIDTH, i, kerbSize, kerbSize);
        }
        // Şeritler
        ctx.strokeStyle = "#bdc3c7"; ctx.setLineDash([40, 50]); ctx.lineDashOffset = -frame * speed * 1.5;
        ctx.lineWidth = 3;
        for (let i = 1; i < LANES; i++) {
            ctx.beginPath(); ctx.moveTo(roadX + i * LANE_W, 0); ctx.lineTo(roadX + i * LANE_W, canvas.height); ctx.stroke();
        }
    }

    function update() {
        if (!gameRunning || paused) { updateEnginePitch(); if(gameRunning) requestAnimationFrame(update); return; }
        frame++; ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawRoad(); updateEnginePitch();

        player.targetX = getLaneX(player.lane);
        player.currentX += (player.targetX - player.currentX) * 0.18;
        drawCar({ ...player, x: player.currentX });

        if (frame % Math.max(20, 50 - Math.floor(speed*1.2)) === 0) {
            const type = enemyTypes[Math.floor(Math.random()*enemyTypes.length)];
            enemies.push({ lane: Math.floor(Math.random()*LANES), y: -100, w: 42, h: 76, model: type.model, color: type.color });
        }

        enemies.forEach((en, index) => {
            en.y += speed;
            en.x = getLaneX(en.lane);
            drawCar(en);
            // Çarpışma (Hitbox biraz daraltıldı)
            if (player.currentX < en.x + en.w - 8 && player.currentX + player.w - 8 > en.x &&
                player.y < en.y + en.h - 5 && player.y + player.h - 5 > en.y) { gameOver(); }
            if (en.y > canvas.height) {
                enemies.splice(index, 1); score++; scoreElement.innerText = `SKOR: ${score}`;
                if (score % 8 === 0) speed += 0.3;
            }
        });
        requestAnimationFrame(update);
    }

    function gameOver() { gameRunning = false; msgElement.style.display = "block"; msgElement.innerText = "KAZA! TEKRAR DENE"; }
    drawRoad();
    drawCar({ ...player, x: getLaneX(1) });
</script>
</body>
</html>
